/review

Read these documents first:

1. docs/projects/02-ui-integration-phases/PRD.md
   - Section 2: Success Criteria (tool execution requirements)
   - Section 5: Quality Standards (code quality, testing requirements)

2. docs/projects/02-ui-integration-phases/TECH-APPROACH.md
   - Section 3: Phase 2 Deep Dive (tool integration design, approval flow, sequence diagrams)

3. docs/core/dev-standards.md
   - Coding standards, TypeScript strict mode, patterns

4. docs/core/contract-testing-tdd-philosophy.md
   - Testing philosophy, mocked-service approach

5. phase-2/source/checklist.md
   - Verify all tasks complete

6. phase-2/decisions.md
   - Review implementation choices

Focus review on:

**Tool Integration Correctness:**
- Approval callback injection point matches design (Session or Codex.spawn)
- Tool detection and routing works as designed in TECH-APPROACH Section 3
- FunctionCall → ToolRouter → execute → FunctionCallOutput flow correct
- Approval flow works for both approval and denial cases
- Event loop handles multiple events (tool calls, results, final response)
- No ported modules modified unnecessarily (ToolRouter, ToolRegistry, Session used as-is)

**Contract Coverage:**
- Mocked-service tests cover approval flow (approved and denied cases)
- Mocked-service tests cover tool execution (success and failure)
- Mocked-service tests cover multiple tools in sequence
- Mocked-service tests cover error cases (tool not found, execution fails)
- Tests verify functional outcomes (user can execute tools, see results)
- External boundaries properly mocked (ModelClient returns FunctionCall, tool handlers don't execute)

**Code Quality:**
- TypeScript strict mode (no any types)
- ESLint clean (0 errors)
- Proper error handling (tool not found, approval denied, execution fails)
- Clear naming, JSDoc on new public methods
- Display functions clear (tool call and result rendering understandable)

**Security:**
- Approval prompt displays tool name AND arguments (user can make informed decision)
- Dangerous tools require approval (exec, applyPatch)
- No command injection in approval display
- Tool execution errors don't expose system internals

**User Experience:**
- Approval prompts clear (user understands what they're approving)
- Tool calls visible (user sees tools executing)
- Tool results displayed (user sees outcomes)
- Error messages actionable (clear what went wrong)

**Testing:**
- Mocked-service tests meaningful (not just mock verification)
- Tests exercise complete workflows (tool request → approval → execution → result → model sees result)
- Edge cases covered (denial, not found, execution failure)
- Display rendering tested (verify user sees tool activity)

Report critical/major/minor issues with file:line references.
Coder will address or argue each issue before phase completion.
