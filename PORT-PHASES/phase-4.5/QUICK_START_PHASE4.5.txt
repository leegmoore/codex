===== COPY THIS INTO FRESH CLAUDE CODE SESSION FOR PHASE 4.5 =====

ROLE: You are a TypeScript developer optimizing the script harness and migrating tools.

PROJECT: Codex TypeScript port - production-ready script harness with complete tool set.

STRATEGY: Tool migration + performance optimization + documentation.

CURRENT PHASE: Phase 4.5 - Script Harness Optimization & Tools

PHASE 4.4 STATUS: ✅ COMPLETE (Core implementation, 401 tests, QuickJS working)

NOTE: Workspace is /Users/leemoore/code/codex-port-02
(TypeScript port is in codex-ts/ subdirectory)

FIRST: Read status
- Read codex-ts/src/core/script-harness/ (what's built)
- Read PORT-PHASES/phase-4.5/README.md (detailed plan)
- Read PORT-PHASES/phase-4.5/CHECKLIST.md (task list)
- Read PORT-PHASES/phase-4.5/STATUS.md (progress)

PHASE 4.5 TASKS:

Task 1: Tool Migration from codex-port
- REPLACE applyPatch: Copy ~/code/v/codex-port/src/tools/applyPatch/ (has full tree-sitter, ours is stubbed)
- ADD readFile: Copy ~/code/v/codex-port/src/tools/readFile.ts (smart indentation mode)
- ADD listDir: Copy ~/code/v/codex-port/src/tools/listDir.ts (recursive listing)
- ADD grepFiles: Copy ~/code/v/codex-port/src/tools/grepFiles.ts (ripgrep search)
- Adapt: Update imports (.js), types (ToolResult), Bun→Node.js
- Result: 6 tools vs current 3

Task 2: tools.spawn
- Detached tasks for long-running ops (phone-a-sme takes 10+ min)
- spawn.exec() + spawn.cancel()

Task 3: Performance
- Worker pool (reuse workers)
- Context reuse (reset vs recreate)
- Script caching (by hash)
- Compilation caching (TS→JS)

Task 4: Documentation
- 5 guides (user, API, config, errors, ops)

WORKFLOW:
1. Complete tool migration first (critical)
2. Then tools.spawn
3. Then performance optimizations
4. Finally documentation

PER TASK:
1. Follow CHECKLIST steps
2. Run: npm test (must pass!)
3. Commit: git add -A && git commit -m "phase4.5: [TASK]" && git push
4. Update logs

DEV STANDARDS:
- Use npm
- TypeScript strict mode
- Prettier formatting
- 100% test pass rate

BEFORE ENDING SESSION:
1. Update PORT-PHASES/phase-4.5/CHECKLIST.md
2. Update PORT-PHASES/phase-4.5/STATUS.md
3. Update codex-ts/PORT_LOG_MASTER.md
4. git add -A && git commit -m "phase4.5: [what you did]" && git push
5. Report: tasks done, tools added, what's next

START with Task 1 (tool migration) - most critical.
